

<!-- Modal -->
<div class="modal fade" id="uvaModal" tabindex="-1" role="dialog" aria-labelledby="uvaModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="text-bold modal-title" id="uvaModalLabel">Verify your identity</h4>
            </div>
            <div class="modal-body">
                <h4>We need to verify that the account belongs to you. Please follow these steps.</h4>
                <div class="row nopadding">
                    <p>1. Change your username on UVA online judge to:</p>
                    <h3 class="text-bold" id="uvaUsename" style="letter-spacing: 1.5px;"><%= profile.randomUvaName %></h3>
                    <div class="help-block">* You can change your username after verification</div>
                </div>
                <div class="row nopadding">
                    <p>2. Enter your UVA online Judge ID:</p>
                    <input type="text" name="uvaId" class="form-control notify"  id="uvaId" placeholder="UVA Online Judge Id"  >
                    <div class="help-block">
                        <p>* You can find your online judge id in My Account section.</p>
                        <p>* Or, Go to the following link to find you online judge id. ( replace {username} with your uva username ) </p>
                        <p>http://uhunt.felix-halim.net/api/uname2uid/{username}</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="verifyUvaId">Verify</button>
            </div>
        </div>
    </div>
</div>


<script>

    $(document).ready(function() {

    });

    $("#verifyUvaId").click(function (e) {

        if( $('#uvaId').val() === '' ){
            $('#uvaId').notify('Please enter uva id', 'error');
            return;
        }


        $.ajax({
            url: "/auth/uva",
            type: "POST",
            dataType: "json",
            cache: false,
            data: {
                uvaUsename: $("#uvaUsename").html(),
                uvaID: $("#uvaId").val()
            },
            beforeSend: function (xhr) {

            }
        })
            .done(function (data) {

                if( data.error ){
                    alert('error!');
                    return;
                }

                if( data.verified ){
                    alert('varified!');
                    return;
                }

                if( data.status == 404 ){
                    alert('not found');
                    return;
                }

                alert('username does not match');
            })
            .fail(function () {
                alert('failed!');
            })
            .always(function () {

            });
    });

</script>